C++ è®¾è®¡æ¨¡å¼

# å•ä¾‹æ¨¡å¼
å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚å•ä¾‹æ¨¡å¼åœ¨C++ä¸­æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œå¸¸è§çš„æœ‰æ‡’æ±‰å¼ï¼ˆLazy Initializationï¼‰å’Œé¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰ã€‚

1. ç§æœ‰åŒ–æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–
2. æä¾›ä¸€ä¸ªé™æ€æ–¹æ³•è·å–å”¯ä¸€å®ä¾‹
3. çº¿ç¨‹å®‰å…¨ï¼ˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼‰
4. ç¦æ­¢æ‹·è´å’Œèµ‹å€¼

## æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ï¼ˆLazy Initializationï¼‰â€”â€” åŠ¨æ€æ–¹å¼
æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œé€‚ç”¨äºéœ€è¦å»¶è¿ŸåŠ è½½çš„åœºæ™¯ã€‚

```cpp
#include <iostream>
#include <mutex>

class Singleton {

private:
    // ç§æœ‰æ„é€ å‡½æ•°
    Singleton() {
        std::cout << "Singleton created" << std::endl;
    }

    // ç§æœ‰ææ„å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨åˆ é™¤å®ä¾‹
    ~Singleton() {
        std::cout << "Singleton instance destroyed" << std::endl;
    }

    static Singleton* instance_;
    static std::mutex mutex_;

public:
    // è·å–å®ä¾‹çš„é™æ€æ–¹æ³•
    static Singleton* getInstance() {
        if (instance_ == nullptr) { // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œé¿å…æ¯æ¬¡åŠ é”
            std::lock_guard<std::mutex> lock(mutex_);
            if (instance_ == nullptr) { // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»º
                instance_ = new Singleton();
            }
        }
        return instance_;
    }

    // åˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦
    Singleton(const Singleton&) = delete;
    Singleton& operator=(const Singleton&) = delete;

    // ä¾›å¤–ç•Œè°ƒç”¨çš„ç¤ºä¾‹æ–¹æ³•
    void doSomething() {
        std::cout << "Doing something..." << std::endl;
    }

    // æ˜¾å¼åˆ é™¤å®ä¾‹çš„é™æ€æ–¹æ³•
    static void destroyInstance() {
        std::lock_guard<std::mutex> lock(mutex_);
        if (instance_ != nullptr) {
            delete instance_;
            instance_ = nullptr;
        }
    }
};

// åˆå§‹åŒ–é™æ€æˆå‘˜å˜é‡
Singleton* Singleton::instance_ = nullptr;
std::mutex Singleton::mutex_;

int main() {
    Singleton* s1 = Singleton::getInstance();
    s1->doSomething();

    Singleton* s2 = Singleton::getInstance();
    s2->doSomething();

    return 0;
}
```

### ä½¿ç”¨é™æ€æˆå‘˜å‡½æ•°è·å–å®ä¾‹
åœ¨æ‡’æ±‰æ¨¡å¼ä¸­ï¼Œè·å–å®ä¾‹çš„æ–¹æ³•é€šå¸¸æ˜¯ä¸€ä¸ªé™æ€æˆå‘˜å‡½æ•°ã€‚è¿™æ˜¯å› ä¸ºé™æ€æˆå‘˜å‡½æ•°å¯ä»¥åœ¨æ²¡æœ‰å®ä¾‹çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œè€Œæ™®é€šæˆå‘˜å‡½æ•°åˆ™éœ€è¦é€šè¿‡ç±»çš„å®ä¾‹æ¥è°ƒç”¨ã€‚

é™æ€æˆå‘˜å‡½æ•°çš„ç‰¹æ€§ï¼š
- **æ— éœ€å®ä¾‹**ï¼šé™æ€æˆå‘˜å‡½æ•°å±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯ç±»çš„æŸä¸ªå®ä¾‹ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨æ²¡æœ‰åˆ›å»ºä»»ä½•å®ä¾‹çš„æƒ…å†µä¸‹è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ã€‚
- **å…¨å±€è®¿é—®**ï¼šé™æ€æˆå‘˜å‡½æ•°å¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œä¸ºå…¨å±€è®¿é—®ç‚¹æä¾›äº†ä¾¿åˆ©ã€‚

åœ¨æ‡’æ±‰æ¨¡å¼ä¸­ï¼Œå•ä¾‹ç±»çš„å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šè¢«åˆ›å»ºã€‚å¦‚æœè·å–å®ä¾‹çš„æ–¹æ³•æ˜¯æ™®é€šæˆå‘˜å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨è¯¥æ–¹æ³•ä¹‹å‰å¿…é¡»å·²ç»æœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œè¿™å°±è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ã€‚å› æ­¤ï¼Œè·å–å®ä¾‹çš„æ–¹æ³•å¿…é¡»æ˜¯é™æ€æˆå‘˜å‡½æ•°ã€‚

é™æ€æˆå‘˜å‡½æ•°ï¼š
- **æ— éœ€å®ä¾‹**ï¼šé™æ€æˆå‘˜å‡½æ•°å¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œè€Œä¸éœ€è¦å®ä¾‹ã€‚
- **æ— æ³•è®¿é—®éé™æ€æˆå‘˜**ï¼šé™æ€æˆå‘˜å‡½æ•°ä¸èƒ½è®¿é—®ç±»çš„éé™æ€æˆå‘˜å˜é‡å’Œéé™æ€æˆå‘˜å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ `this` æŒ‡é’ˆã€‚
- **å…±äº«æ•°æ®**ï¼šé™æ€æˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®é™æ€æˆå‘˜å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨æ‰€æœ‰å®ä¾‹ä¹‹é—´å…±äº«ã€‚

æ™®é€šæˆå‘˜å‡½æ•°ï¼š
- **éœ€è¦å®ä¾‹**ï¼šæ™®é€šæˆå‘˜å‡½æ•°å¿…é¡»é€šè¿‡ç±»çš„å®ä¾‹æ¥è°ƒç”¨ã€‚
- **å¯ä»¥è®¿é—®æ‰€æœ‰æˆå‘˜**ï¼šæ™®é€šæˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°ï¼ˆåŒ…æ‹¬é™æ€å’Œéé™æ€ï¼‰ã€‚
- **æœ‰ `this` æŒ‡é’ˆ**ï¼šæ™®é€šæˆå‘˜å‡½æ•°æœ‰ä¸€ä¸ªéšå«çš„ `this` æŒ‡é’ˆï¼ŒæŒ‡å‘è°ƒç”¨è¯¥å‡½æ•°çš„å®ä¾‹ã€‚

é™æ€å‡½æ•°ï¼š
- **å…¨å±€ä½œç”¨åŸŸ**ï¼šé™æ€å‡½æ•°é€šå¸¸æ˜¯æŒ‡åœ¨æ–‡ä»¶ä½œç”¨åŸŸå†…çš„é™æ€å‡½æ•°ï¼ˆä½¿ç”¨ `static` å…³é”®å­—ä¿®é¥°çš„å‡½æ•°ï¼‰ï¼Œå®ƒä»¬çš„ä½œç”¨èŒƒå›´ä»…é™äºå®šä¹‰å®ƒä»¬çš„æºæ–‡ä»¶ã€‚
- **æ–‡ä»¶å†…å¯è§**ï¼šé™æ€å‡½æ•°åœ¨å®šä¹‰å®ƒä»¬çš„æºæ–‡ä»¶ä¹‹å¤–ä¸å¯è§ï¼Œé€šå¸¸ç”¨äºå®ç°æ–‡ä»¶å†…çš„è¾…åŠ©åŠŸèƒ½ã€‚

é™æ€æˆå‘˜å‡½æ•°ï¼š
- **ç±»ä½œç”¨åŸŸ**ï¼šé™æ€æˆå‘˜å‡½æ•°æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œå±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯æŸä¸ªå®ä¾‹ã€‚
- **ç±»å†…å¯è§**ï¼šé™æ€æˆå‘˜å‡½æ•°å¯ä»¥åœ¨ç±»çš„èŒƒå›´å†…è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç±»ååœ¨å…¨å±€èŒƒå›´å†…è®¿é—®ã€‚

| ç‰¹æ€§         | é™æ€å‡½æ•° (Static Function)               | æ™®é€šå‡½æ•° (Non-static Function)   |
| ------------ | ---------------------------------------- | -------------------------------- |
| **ä½œç”¨åŸŸ**   | æ–‡ä»¶ä½œç”¨åŸŸï¼Œåªèƒ½åœ¨å®šä¹‰å®ƒä»¬çš„æºæ–‡ä»¶ä¸­è°ƒç”¨ | å…¨å±€ä½œç”¨åŸŸï¼Œå¯ä»¥åœ¨å¤šä¸ªæ–‡ä»¶ä¸­è°ƒç”¨ |
| **é“¾æ¥ç±»å‹** | å†…éƒ¨é“¾æ¥ï¼ˆinternal linkageï¼‰             | å¤–éƒ¨é“¾æ¥ï¼ˆexternal linkageï¼‰     |
| **å¯è§æ€§**   | ä»…åœ¨å®šä¹‰å®ƒä»¬çš„æºæ–‡ä»¶ä¸­å¯è§               | å¯ä»¥åœ¨å…¶ä»–æ–‡ä»¶ä¸­å£°æ˜å¹¶è°ƒç”¨       |
| **ç”¨é€”**     | æ–‡ä»¶å†…çš„è¾…åŠ©åŠŸèƒ½ï¼Œé¿å…å‘½åå†²çª           | å…¨å±€åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å¤šä¸ªæ–‡ä»¶ä¸­å…±äº«   |


```cpp
#include <iostream>

class MyClass {
public:
    // é™æ€æˆå‘˜å‡½æ•°
    static void staticMemberFunction() {
        std::cout << "Static member function called" << std::endl;
        // æ— æ³•è®¿é—®éé™æ€æˆå‘˜å˜é‡æˆ–éé™æ€æˆå‘˜å‡½æ•°
        // std::cout << "Non-static member variable: " << nonStaticMember << std::endl; // é”™è¯¯
    }

    // æ™®é€šæˆå‘˜å‡½æ•°
    void nonStaticMemberFunction() {
        std::cout << "Non-static member function called" << std::endl;
        std::cout << "Non-static member variable: " << nonStaticMember << std::endl;
    }

    // é™æ€æˆå‘˜å˜é‡
    static int staticMember;

    // éé™æ€æˆå‘˜å˜é‡
    int nonStaticMember;

    // æ„é€ å‡½æ•°
    MyClass() : nonStaticMember(42) {}
};

// é™æ€æˆå‘˜å˜é‡å®šä¹‰
int MyClass::staticMember = 0;

// é™æ€å‡½æ•°ï¼ˆæ–‡ä»¶ä½œç”¨åŸŸï¼‰
static void staticFunction() {
    std::cout << "Static function called" << std::endl;
}

int main() {
    // è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°
    MyClass::staticMemberFunction();

    // åˆ›å»ºç±»çš„å®ä¾‹
    MyClass obj;

    // è°ƒç”¨æ™®é€šæˆå‘˜å‡½æ•°
    obj.nonStaticMemberFunction();

    // è°ƒç”¨é™æ€å‡½æ•°
    staticFunction();

    return 0;
}
```

è¾“å‡ºç»“æœï¼š
```
Static member function called
Non-static member function called
Non-static member variable: 42
Static function called
```

### å¤šçº¿ç¨‹å®‰å…¨
åœ¨ä¸Šé¢çš„å•ä¾‹æ¨¡å¼ä¸­ï¼Œ`std::lock_guard<std::mutex>` ç”¨äºç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹å•ä¾‹å®ä¾‹çš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ `getInstance` æ–¹æ³•ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹åŒæ—¶æ£€æµ‹åˆ° `instance_` ä¸º `nullptr`ï¼Œä»è€Œåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚è¿™è¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ï¼Œå³ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚

`std::lock_guard` æ˜¯ä¸€ä¸ªRAIIï¼ˆResource Acquisition Is Initializationï¼‰ç±»ï¼Œç”¨äºåœ¨ä½œç”¨åŸŸå†…è‡ªåŠ¨ç®¡ç†äº’æ–¥é”çš„é”å®šå’Œè§£é”ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç¡®ä¿åœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´äº’æ–¥é”è¢«æ­£ç¡®åœ°é”å®šå’Œè§£é”ï¼Œä»¥é˜²æ­¢èµ„æºç«äº‰å’Œæ•°æ®ä¸ä¸€è‡´ã€‚
1. **é”å®šäº’æ–¥é”**ï¼š
   - å½“ `std::lock_guard` å¯¹è±¡åˆ›å»ºæ—¶ï¼Œå®ƒä¼šé”å®šä¼ å…¥çš„äº’æ–¥é”ï¼Œç¡®ä¿åœ¨ `getInstance` æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•åŒæ—¶è®¿é—®è¯¥æ–¹æ³•ã€‚

2. **è‡ªåŠ¨è§£é”**ï¼š
   - å½“ `std::lock_guard` å¯¹è±¡è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼ˆä¾‹å¦‚ï¼Œå‡½æ•°è¿”å›æ—¶ï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨è§£é”äº’æ–¥é”ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨è§£é”æ“ä½œã€‚è¿™å‡å°‘äº†æ‰‹åŠ¨ç®¡ç†é”çš„å¤æ‚æ€§å’Œæ½œåœ¨çš„é”™è¯¯ã€‚

- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨ `std::mutex` ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚
- **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šå®ä¾‹åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ `getInstance` æ—¶åˆ›å»ºã€‚
- **é˜²æ­¢æ‹·è´å’Œèµ‹å€¼**ï¼šåˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ã€‚

## æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ â€”â€” é™æ€æ–¹å¼

```cpp
#include <iostream>

class Singleton {
public:
    // è·å–å®ä¾‹çš„é™æ€æ–¹æ³•
    static Singleton& getInstance() {
        static Singleton instance; // å±€éƒ¨é™æ€å˜é‡ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–
        return instance;
    }

    // åˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦
    Singleton(const Singleton&) = delete;
    Singleton& operator=(const Singleton&) = delete;

    // ä¾›å¤–ç•Œè°ƒç”¨çš„ç¤ºä¾‹æ–¹æ³•
    void doSomething() {
        std::cout << "Doing something..." << std::endl;
    }

private:
    // ç§æœ‰æ„é€ å‡½æ•°
    Singleton() {
        std::cout << "Singleton created" << std::endl;
    }
    // ææ„å‡½æ•°
    ~Singleton() {
        std::cout << "Singleton destroyed" << std::endl;
    }

};

int main() {
    Singleton& s1 = Singleton::getInstance();
    s1.doSomething();

    Singleton& s2 = Singleton::getInstance();
    s2.doSomething();

    return 0;
}
```

- **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨ `static` å±€éƒ¨å˜é‡ï¼ŒC++11 åŠä¹‹åçš„æ ‡å‡†ä¿è¯å…¶çº¿ç¨‹å®‰å…¨ã€‚
- **é˜²æ­¢æ‹·è´å’Œèµ‹å€¼**ï¼šåˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ã€‚
- å•ä¾‹ä¼šåœ¨ç¨‹åºç»“æŸæ—¶è‡ªåŠ¨é”€æ¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚

## é¥¿æ±‰æ¨¡å¼

é¥¿æ±‰æ¨¡å¼æ˜¯å•ä¾‹æ¨¡å¼çš„å¦ä¸€ç§å®ç°æ–¹å¼ï¼Œä¸æ‡’æ±‰æ¨¡å¼ç›¸åï¼Œå®ƒåœ¨ç¨‹åºå¯åŠ¨æ—¶æˆ–ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»ºã€‚

1. **æå‰åˆå§‹åŒ–**ï¼šå®ä¾‹åœ¨ç¨‹åºå¯åŠ¨æ—¶æˆ–ç±»åŠ è½½æ—¶å°±è¢«åˆ›å»º
2. **çº¿ç¨‹å®‰å…¨**ï¼šç”±äºå®ä¾‹åœ¨è¿›å…¥mainå‡½æ•°å‰å°±å·²åˆ›å»ºï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰é—®é¢˜
3. **ç®€å•ç›´æ¥**ï¼šå®ç°é€šå¸¸æ¯”æ‡’æ±‰æ¨¡å¼æ›´ç®€å•
4. **å¯èƒ½æµªè´¹èµ„æº**ï¼šå¦‚æœå®ä¾‹æœ€ç»ˆæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¼šé€ æˆèµ„æºæµªè´¹

```cpp
#include <iostream>

class EagerSingleton {
public:
    // è·å–å•ä¾‹å®ä¾‹çš„é™æ€æ–¹æ³•
    static EagerSingleton& getInstance() {
        return instance;
    }
    
    // åˆ é™¤æ‹·è´æ„é€ å’Œèµ‹å€¼æ“ä½œç¬¦
    EagerSingleton(const EagerSingleton&) = delete;
    EagerSingleton& operator=(const EagerSingleton&) = delete;
    
    void doSomething() {
        std::cout << "EagerSingleton doing something..." << std::endl;
    }

private:
    EagerSingleton() {
        std::cout << "EagerSingleton created at program start" << std::endl;
    }
    
    ~EagerSingleton() {
        std::cout << "EagerSingleton destroyed" << std::endl;
    }
    
    // é™æ€æˆå‘˜å˜é‡ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–
    static EagerSingleton instance;
};

// åœ¨ç±»å¤–å®šä¹‰å¹¶åˆå§‹åŒ–é™æ€æˆå‘˜
EagerSingleton EagerSingleton::instance;
```

**ç‰¹ç‚¹**ï¼š
- å®ä¾‹ä½œä¸ºé™æ€æˆå‘˜å˜é‡ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–
- çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥æœºåˆ¶
- ä»£ç ç®€å•ç›´æ¥

ä¼˜ç‚¹
1. **çº¿ç¨‹å®‰å…¨**ï¼šå®ä¾‹åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰é—®é¢˜
2. **å®ç°ç®€å•**ï¼šæ— éœ€å¤æ‚çš„åŒæ­¥æœºåˆ¶
3. **æ€§èƒ½è‰¯å¥½**ï¼šæ²¡æœ‰è¿è¡Œæ—¶æ£€æŸ¥çš„å¼€é”€
4. **ç¡®å®šæ€§**ï¼šå®ä¾‹çš„åˆ›å»ºæ—¶æœºæ˜¯ç¡®å®šçš„ï¼ˆç¨‹åºå¯åŠ¨æ—¶ï¼‰

ç¼ºç‚¹
1. **å¯èƒ½æµªè´¹èµ„æº**ï¼šå¦‚æœå®ä¾‹æœ€ç»ˆæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œä¼šé€ æˆèµ„æºæµªè´¹
2. **å¯åŠ¨æ—¶é—´å¯èƒ½è¾ƒé•¿**ï¼šå¦‚æœå®ä¾‹åˆå§‹åŒ–å¾ˆè€—æ—¶ï¼Œä¼šå»¶é•¿ç¨‹åºå¯åŠ¨æ—¶é—´
3. **åˆå§‹åŒ–é¡ºåºé—®é¢˜**ï¼šå¦‚æœå¤šä¸ªå•ä¾‹ç›¸äº’ä¾èµ–ï¼Œå¯èƒ½å­˜åœ¨åˆå§‹åŒ–é¡ºåºé—®é¢˜
4. **æ— æ³•ä¼ é€’å‚æ•°**ï¼šç”±äºå®ä¾‹åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œæ— æ³•åœ¨è¿è¡Œæ—¶ä¼ é€’åˆå§‹åŒ–å‚æ•°

é¥¿æ±‰æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

1. **å®ä¾‹è¾ƒå°ä¸”åˆå§‹åŒ–ç®€å•**ï¼šä¸ä¼šæ˜¾è‘—å½±å“ç¨‹åºå¯åŠ¨æ—¶é—´
2. **å®ä¾‹ä¸€å®šä¼šè¢«ä½¿ç”¨**ï¼šé¿å…èµ„æºæµªè´¹
3. **å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜**ï¼šå¸Œæœ›é¿å…è¿è¡Œæ—¶åŒæ­¥å¼€é”€
4. **å¤šçº¿ç¨‹ç¯å¢ƒ**ï¼šå¸Œæœ›é¿å…å¤æ‚çš„åŒæ­¥é€»è¾‘
5. **åˆå§‹åŒ–ä¸ä¾èµ–è¿è¡Œæ—¶å‚æ•°**ï¼šæ‰€æœ‰åˆå§‹åŒ–æ•°æ®åœ¨ç¼–è¯‘æ—¶æˆ–å¯åŠ¨æ—¶å·²çŸ¥

# å·¥å‚æ¨¡å¼

å·¥å‚æ¨¡å¼æ˜¯åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¸­æœ€å¸¸ç”¨çš„ä¸€ç§ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ï¼Œè€Œæ— éœ€æš´éœ²å¯¹è±¡åˆ›å»ºçš„é€»è¾‘ã€‚åœ¨C++ä¸­ï¼Œå·¥å‚æ¨¡å¼ä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼šç®€å•å·¥å‚æ¨¡å¼ã€å·¥å‚æ–¹æ³•æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ã€‚

## ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰

ç®€å•å·¥å‚æ¨¡å¼é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°å†³å®šåˆ›å»ºå“ªç§äº§å“ç±»çš„å®ä¾‹ã€‚

```cpp
#include <iostream>
#include <memory>
#include <string>

// äº§å“æ¥å£
class Shape {
public:
    virtual void draw() = 0;
    virtual ~Shape() = default;
};

// å…·ä½“äº§å“ç±»
class Circle : public Shape {
public:
    void draw() override {
        std::cout << "Drawing a Circle" << std::endl;
    }
};

class Rectangle : public Shape {
public:
    void draw() override {
        std::cout << "Drawing a Rectangle" << std::endl;
    }
};

class Triangle : public Shape {
public:
    void draw() override {
        std::cout << "Drawing a Triangle" << std::endl;
    }
};

// ç®€å•å·¥å‚ç±»
class ShapeFactory {
public:
    // æ ¹æ®ç±»å‹åˆ›å»ºå½¢çŠ¶å¯¹è±¡
    static std::unique_ptr<Shape> createShape(const std::string& type) {
        if (type == "Circle") {
            return std::make_unique<Circle>();
        } else if (type == "Rectangle") {
            return std::make_unique<Rectangle>();
        } else if (type == "Triangle") {
            return std::make_unique<Triangle>();
        } else {
            throw std::invalid_argument("Unknown shape type: " + type);
        }
    }
};

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    try {
        auto circle = ShapeFactory::createShape("Circle");
        circle->draw();
        
        auto rectangle = ShapeFactory::createShape("Rectangle");
        rectangle->draw();
        
        auto triangle = ShapeFactory::createShape("Triangle");
        triangle->draw();
        
    } catch (const std::exception& e) {
        std::cerr << "Error: " << e.what() << std::endl;
    }
    
    return 0;
}
```

**ä¼˜ç‚¹**ï¼š
- å®¢æˆ·ç«¯ä¸å…·ä½“äº§å“ç±»è§£è€¦
- å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“äº§å“çš„ç±»åï¼Œåªéœ€è¦çŸ¥é“ç±»å‹å‚æ•°

**ç¼ºç‚¹**ï¼š
- è¿åå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰
- æ·»åŠ æ–°äº§å“éœ€è¦ä¿®æ”¹å·¥å‚ç±»
- å·¥å‚ç±»èŒè´£è¿‡é‡ï¼Œä¸æ˜“äºæ‰©å±•

## å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰

å·¥å‚æ–¹æ³•æ¨¡å¼å…¶å®å°±åƒä¸€ä¸ª**"ä»£å·¥å‚"**çš„æ¦‚å¿µã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œå¼€äº†ä¸€å®¶æ¯”è¨åº—çš„æ€»å…¬å¸ï¼Œæƒ³è¦åœ¨ä¸åŒåŸå¸‚å¼€åˆ†åº—ã€‚æ¯ä¸ªåœ°æ–¹çš„é¡¾å®¢å£å‘³ä¸åŒï¼š

- çº½çº¦åº—ï¼šå–œæ¬¢è–„è„†æ¯”è¨
- èŠåŠ å“¥åº—ï¼šå–œæ¬¢åšåº•æ¯”è¨
- åŠ å·åº—ï¼šå–œæ¬¢å¥åº·è”¬èœæ¯”è¨

å¦‚æœæ²¡æœ‰å·¥å‚æ–¹æ³•æ¨¡å¼

```cpp
// ç³Ÿç³•çš„åšæ³•ï¼šæ€»åº—ç›´æ¥å†³å®šåšä»€ä¹ˆæ¯”è¨
class PizzaStore {
public:
    Pizza* orderPizza(string type) {
        Pizza* pizza;
        
        // æ€»åº—éœ€è¦çŸ¥é“æ‰€æœ‰åˆ†åº—çš„å…·ä½“åšæ³•
        if (type == "ny") {
            pizza = new NYStylePizza();
        } else if (type == "chicago") {
            pizza = new ChicagoStylePizza();
        } else if (type == "california") {
            pizza = new CaliforniaStylePizza();
        }
        // æ¯å¼€ä¸€å®¶æ–°åˆ†åº—ï¼Œè¿™é‡Œå°±è¦ä¿®æ”¹ä»£ç ï¼
        
        pizza->prepare();
        pizza->bake();
        pizza->cut();
        pizza->box();
        return pizza;
    }
};
```

**é—®é¢˜**ï¼šæ¯æ¬¡å¼€æ–°åˆ†åº—ï¼Œæ€»åº—éƒ½è¦ä¿®æ”¹ä»£ç ï¼Œè¿™å¾ˆéº»çƒ¦ï¼

ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼

```cpp
// æ€»åº—åªå®šä¹‰æµç¨‹ï¼Œè®©åˆ†åº—è‡ªå·±å†³å®šåšä»€ä¹ˆæ¯”è¨
class PizzaStore {
public:
    // è¿™å°±æ˜¯å·¥å‚æ–¹æ³•ï¼æ¯ä¸ªåˆ†åº—è‡ªå·±å®ç°
    virtual Pizza* createPizza(string type) = 0;
    
    // æ€»åº—ç»Ÿä¸€æµç¨‹
    Pizza* orderPizza(string type) {
        Pizza* pizza = createPizza(type); // è®©åˆ†åº—è‡ªå·±åšæ¯”è¨
        pizza->prepare();
        pizza->bake();
        pizza->cut();
        pizza->box();
        return pizza;
    }
};

// çº½çº¦åˆ†åº—ï¼šè‡ªå·±åšè–„è„†æ¯”è¨
class NYPizzaStore : public PizzaStore {
public:
    Pizza* createPizza(string type) override {
        if (type == "cheese") {
            return new NYStyleCheesePizza();
        } else if (type == "pepperoni") {
            return new NYStylePepperoniPizza();
        }
        // çº½çº¦åº—è‡ªå·±å†³å®šåšä»€ä¹ˆæ¯”è¨
        return nullptr;
    }
};

// èŠåŠ å“¥åˆ†åº—ï¼šè‡ªå·±åšåšåº•æ¯”è¨  
class ChicagoPizzaStore : public PizzaStore {
public:
    Pizza* createPizza(string type) override {
        if (type == "cheese") {
            return new ChicagoStyleCheesePizza();
        } else if (type == "veggie") {
            return new ChicagoStyleVeggiePizza();
        }
        // èŠåŠ å“¥åº—è‡ªå·±å†³å®šåšä»€ä¹ˆæ¯”è¨
        return nullptr;
    }
};
```

### å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³

1. åˆ†ç¦»"åšä»€ä¹ˆ"å’Œ"æ€ä¹ˆåš"
- **æ€»åº—ï¼ˆçˆ¶ç±»ï¼‰**ï¼šåªçŸ¥é“"è¦åšä¸€ä¸ªæ¯”è¨"ï¼ˆåšä»€ä¹ˆï¼‰
- **åˆ†åº—ï¼ˆå­ç±»ï¼‰**ï¼šå†³å®š"å…·ä½“æ€ä¹ˆåšè¿™ä¸ªæ¯”è¨"ï¼ˆæ€ä¹ˆåšï¼‰

2. ä¾èµ–å€’ç½®åŸåˆ™
ä¸è¦ä¾èµ–å…·ä½“å®ç°ï¼Œè¦ä¾èµ–æŠ½è±¡æ¥å£ã€‚æ€»åº—ä¸å…³å¿ƒå…·ä½“æ˜¯ä»€ä¹ˆæ¯”è¨ï¼Œåªå…³å¿ƒå®ƒæ˜¯æ¯”è¨ã€‚

3. å¼€é—­åŸåˆ™
å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å¼€æ–°åˆ†åº—æ—¶ï¼Œåªéœ€è¦æ–°å¢ä»£ç ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç ã€‚

### ç¤ºä¾‹

```cpp
#include <iostream>
#include <string>
using namespace std;

// äº§å“æ¥å£ï¼šæ¯”è¨
class Pizza {
public:
    virtual void prepare() = 0;
    virtual void bake() = 0;
    virtual void cut() = 0;
    virtual void box() = 0;
    virtual ~Pizza() {}
};

// å…·ä½“äº§å“ï¼šçº½çº¦å¥¶é…ªæ¯”è¨
class NYStyleCheesePizza : public Pizza {
public:
    void prepare() override { cout << "å‡†å¤‡çº½çº¦é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
    void bake() override { cout << "çƒ˜çƒ¤çº½çº¦é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
    void cut() override { cout << "åˆ‡å‰²çº½çº¦é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
    void box() override { cout << "è£…ç›’çº½çº¦é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
};

// å…·ä½“äº§å“ï¼šèŠåŠ å“¥å¥¶é…ªæ¯”è¨
class ChicagoStyleCheesePizza : public Pizza {
public:
    void prepare() override { cout << "å‡†å¤‡èŠåŠ å“¥é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
    void bake() override { cout << "çƒ˜çƒ¤èŠåŠ å“¥é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
    void cut() override { cout << "åˆ‡å‰²èŠåŠ å“¥é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
    void box() override { cout << "è£…ç›’èŠåŠ å“¥é£æ ¼å¥¶é…ªæ¯”è¨" << endl; }
};

// åˆ›å»ºè€…æŠ½è±¡ç±»ï¼šæ¯”è¨åº—
class PizzaStore {
public:
    // å·¥å‚æ–¹æ³•ï¼šè®©å­ç±»å®ç°
    virtual Pizza* createPizza(string type) = 0;
    
    // è®¢å•æµç¨‹ï¼šçˆ¶ç±»å®šä¹‰
    Pizza* orderPizza(string type) {
        Pizza* pizza = createPizza(type);
        pizza->prepare();
        pizza->bake();
        pizza->cut();
        pizza->box();
        return pizza;
    }
    
    virtual ~PizzaStore() {}
};

// å…·ä½“åˆ›å»ºè€…ï¼šçº½çº¦æ¯”è¨åº—
class NYPizzaStore : public PizzaStore {
public:
    Pizza* createPizza(string type) override {
        if (type == "cheese") {
            return new NYStyleCheesePizza();
        }
        // å¯ä»¥æ‰©å±•å…¶ä»–ç±»å‹çš„æ¯”è¨
        return nullptr;
    }
};

// å…·ä½“åˆ›å»ºè€…ï¼šèŠåŠ å“¥æ¯”è¨åº—
class ChicagoPizzaStore : public PizzaStore {
public:
    Pizza* createPizza(string type) override {
        if (type == "cheese") {
            return new ChicagoStyleCheesePizza();
        }
        // å¯ä»¥æ‰©å±•å…¶ä»–ç±»å‹çš„æ¯”è¨
        return nullptr;
    }
};

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    // å¼€ä¸€å®¶çº½çº¦æ¯”è¨åº—
    PizzaStore* nyStore = new NYPizzaStore();
    Pizza* nyPizza = nyStore->orderPizza("cheese");
    cout << " Ethan è®¢è´­äº†ä¸€ä¸ª " << endl;
    delete nyPizza;
    
    // å¼€ä¸€å®¶èŠåŠ å“¥æ¯”è¨åº—
    PizzaStore* chicagoStore = new ChicagoPizzaStore();
    Pizza* chicagoPizza = chicagoStore->orderPizza("cheese");
    cout << " Joel è®¢è´­äº†ä¸€ä¸ª " << endl;
    delete chicagoPizza;
    
    delete nyStore;
    delete chicagoStore;
    return 0;
}
```

### ç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­

1. **å¿«é€’å…¬å¸**ï¼šæ€»å…¬å¸è§„å®šæ”¶ä»¶ã€è¿è¾“ã€æ´¾é€çš„æµç¨‹ï¼Œä½†æ¯ä¸ªåœ°åŒºçš„ç½‘ç‚¹è‡ªå·±å†³å®šç”¨ä»€ä¹ˆè½¦è¾†ã€èµ°ä»€ä¹ˆè·¯çº¿ã€‚

2. **è¿é”å’–å•¡åº—**ï¼šæ€»éƒ¨è§„å®šåˆ¶ä½œå’–å•¡çš„æ ‡å‡†æµç¨‹ï¼Œä½†æ¯å®¶åˆ†åº—æ ¹æ®å½“åœ°å£å‘³è°ƒæ•´ç³–å’Œç‰›å¥¶çš„æ¯”ä¾‹ã€‚

3. **æ¸¸æˆå¼€å‘**ï¼šæ¸¸æˆå¼•æ“å®šä¹‰åˆ›å»ºè§’è‰²çš„æµç¨‹ï¼Œä½†æ¯ä¸ªæ¸¸æˆè‡ªå·±å†³å®šåˆ›å»ºä»€ä¹ˆç±»å‹çš„è§’è‰²ã€‚

### ä¼˜ç‚¹

1. **è§£è€¦**ï¼šä½¿ç”¨è€…ä¸éœ€è¦çŸ¥é“å¯¹è±¡çš„å…·ä½“åˆ›å»ºç»†èŠ‚
2. **æ‰©å±•æ€§å¥½**ï¼šæ·»åŠ æ–°äº§å“å¾ˆå®¹æ˜“ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
3. **ç¬¦åˆå•ä¸€èŒè´£**ï¼šåˆ›å»ºé€»è¾‘é›†ä¸­åœ¨å·¥å‚ç±»ä¸­
4. **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­

## å·¥å‚æ–¹æ³• vs ç®€å•å·¥å‚

| ç®€å•å·¥å‚                     | å·¥å‚æ–¹æ³•                         |
| ---------------------------- | -------------------------------- |
| ä¸€ä¸ªå·¥å‚ç±»è´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»º | æ¯ä¸ªå…·ä½“äº§å“éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å·¥å‚ç±» |
| æ·»åŠ æ–°äº§å“éœ€è¦ä¿®æ”¹å·¥å‚ç±»     | æ·»åŠ æ–°äº§å“åªéœ€æ·»åŠ æ–°çš„å·¥å‚ç±»     |
| è¿åå¼€é—­åŸåˆ™                 | ç¬¦åˆå¼€é—­åŸåˆ™                     |
| é€‚åˆäº§å“ç§ç±»è¾ƒå°‘çš„æƒ…å†µ       | é€‚åˆäº§å“ç§ç±»è¾ƒå¤šæˆ–å¯èƒ½æ‰©å±•çš„æƒ…å†µ |

## æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰

æŠ½è±¡å·¥å‚æ¨¡å¼å°±åƒä¸€ä¸ª**"å“ç‰Œæ——èˆ°åº—"**çš„æ¦‚å¿µã€‚

æƒ³è±¡ä¸€ä¸‹ï¼Œè¦ä¹°ä¸€å¥—ç”µå­äº§å“ï¼šæ‰‹æœºã€ç¬”è®°æœ¬ã€è€³æœºã€‚ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š

1. **è‹¹æœæ——èˆ°åº—**ï¼šä¹° iPhone + MacBook + AirPods
2. **å°ç±³æ——èˆ°åº—**ï¼šä¹° å°ç±³æ‰‹æœº + å°ç±³ç¬”è®°æœ¬ + å°ç±³è€³æœº

æ¯ä¸ªå“ç‰Œçš„äº§å“éƒ½èƒ½å¾ˆå¥½åœ°é…åˆä½¿ç”¨ï¼Œä½†ä¸åŒå“ç‰Œçš„äº§å“å¯èƒ½ä¸å¤ªå…¼å®¹ã€‚

```cpp
// æŠ½è±¡äº§å“ï¼šæ‰‹æœº
class Phone {
public:
    virtual void makeCall() = 0;
    virtual ~Phone() {}
};

// æŠ½è±¡äº§å“ï¼šç¬”è®°æœ¬
class Laptop {
public:
    virtual void programming() = 0;
    virtual ~Laptop() {}
};

// æŠ½è±¡äº§å“ï¼šè€³æœº
class Earphone {
public:
    virtual void listenMusic() = 0;
    virtual ~Earphone() {}
};

// æŠ½è±¡å·¥å‚ï¼šç”µå­äº§å“å·¥å‚
class ElectronicsFactory {
public:
    virtual Phone* createPhone() = 0;
    virtual Laptop* createLaptop() = 0;
    virtual Earphone* createEarphone() = 0;
    virtual ~ElectronicsFactory() {}
};
```

1. äº§å“å®¶æ—æ¦‚å¿µ
æŠ½è±¡å·¥å‚åˆ›å»ºçš„æ˜¯**ä¸€æ•´å¥—ç›¸å…³çš„äº§å“**ï¼Œè€Œä¸æ˜¯å•ä¸ªäº§å“ã€‚

2. ä¿è¯äº§å“å…¼å®¹æ€§
åŒä¸€ä¸ªå·¥å‚åˆ›å»ºçš„äº§å“èƒ½å¤Ÿå¾ˆå¥½åœ°ååŒå·¥ä½œã€‚

3. åˆ‡æ¢æ•´ä¸ªäº§å“ç³»åˆ—
åªéœ€æ›´æ¢å·¥å‚å¯¹è±¡ï¼Œå°±èƒ½åˆ‡æ¢æ•´ä¸ªäº§å“ç³»åˆ—ã€‚

### ä»£ç ç»“æ„

```
æŠ½è±¡å·¥å‚æ¨¡å¼åŒ…å«4ä¸ªè§’è‰²ï¼š
1. æŠ½è±¡äº§å“ï¼ˆAbstract Productï¼‰ï¼šå®šä¹‰äº§å“çš„æ¥å£
2. å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ï¼šå®ç°å…·ä½“çš„äº§å“
3. æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰ï¼šå£°æ˜åˆ›å»ºäº§å“çš„æ–¹æ³•
4. å…·ä½“å·¥å‚ï¼ˆConcrete Factoryï¼‰ï¼šå®ç°åˆ›å»ºå…·ä½“äº§å“çš„æ–¹æ³•
```

### ç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­

1. **ä¸»é¢˜æ¢è‚¤**ï¼šä¸€å¥—è“è‰²ä¸»é¢˜ï¼ˆè“è‰²æŒ‰é’®ã€è“è‰²è¾¹æ¡†ã€è“è‰²èƒŒæ™¯ï¼‰ vs ä¸€å¥—çº¢è‰²ä¸»é¢˜

2. **æ¸¸æˆé£æ ¼**ï¼šä¸­ä¸–çºªé£æ ¼ï¼ˆéª‘å£«ã€åŸå ¡ã€å‰‘ï¼‰ vs ç§‘å¹»é£æ ¼ï¼ˆå®‡èˆªå‘˜ã€é£èˆ¹ã€æ¿€å…‰æªï¼‰

3. **è·¨å¹³å°å¼€å‘**ï¼šWindowsé£æ ¼æ§ä»¶ vs Macé£æ ¼æ§ä»¶

### ä¼˜ç‚¹

1. **ä¿è¯äº§å“å…¼å®¹æ€§**ï¼šåŒä¸€å®¶æ—çš„äº§å“èƒ½å®Œç¾é…åˆ
2. **åˆ‡æ¢æ–¹ä¾¿**ï¼šåªéœ€æ›´æ¢å·¥å‚ï¼Œå°±èƒ½åˆ‡æ¢æ•´ä¸ªäº§å“ç³»åˆ—
3. **ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šæ·»åŠ æ–°äº§å“æ—å¾ˆå®¹æ˜“
4. **ç¬¦åˆå•ä¸€èŒè´£**ï¼šæ¯ä¸ªå·¥å‚åªè´Ÿè´£åˆ›å»ºç›¸å…³äº§å“

### æŠ½è±¡å·¥å‚ vs å·¥å‚æ–¹æ³•

| å·¥å‚æ–¹æ³•           | æŠ½è±¡å·¥å‚               |
| ------------------ | ---------------------- |
| åˆ›å»ºä¸€ç§äº§å“       | åˆ›å»ºä¸€å¥—ç›¸å…³äº§å“       |
| é€šè¿‡å­ç±»åŒ–åˆ›å»ºå¯¹è±¡ | é€šè¿‡å¯¹è±¡ç»„åˆåˆ›å»ºäº§å“æ— |
| å…³æ³¨äº§å“åˆ›å»º       | å…³æ³¨äº§å“å®¶æ—åˆ›å»º       |
| é€‚åˆäº§å“ç§ç±»å•ä¸€   | é€‚åˆäº§å“ç³»åˆ—åˆ‡æ¢       |

## å®é™…åº”ç”¨ç¤ºä¾‹ï¼šæ¸¸æˆä¸­çš„æ­¦å™¨ç³»ç»Ÿ

```cpp
// æ¸¸æˆä¸­çš„æ­¦å™¨å®¶æ—ï¼šä¸­ä¸–çºª vs ç°ä»£

// æŠ½è±¡äº§å“ï¼šæ­¦å™¨
class Weapon {
public:
    virtual void attack() = 0;
    virtual ~Weapon() {}
};

// æŠ½è±¡äº§å“ï¼šé˜²å…·
class Armor {
public:
    virtual void defend() = 0;
    virtual ~Armor() {}
};

// æŠ½è±¡å·¥å‚ï¼šè£…å¤‡å·¥å‚
class EquipmentFactory {
public:
    virtual Weapon* createWeapon() = 0;
    virtual Armor* createArmor() = 0;
    virtual ~EquipmentFactory() {}
};

// ä¸­ä¸–çºªè£…å¤‡
class Sword : public Weapon {
public:
    void attack() override { cout << "âš”ï¸ ç”¨å‰‘æ”»å‡»" << endl; }
};

class Shield : public Armor {
public:
    void defend() override { cout << "ğŸ›¡ï¸ ç”¨ç›¾ç‰Œé˜²å¾¡" << endl; }
};

class MedievalFactory : public EquipmentFactory {
public:
    Weapon* createWeapon() override { return new Sword(); }
    Armor* createArmor() override { return new Shield(); }
};

// ç°ä»£è£…å¤‡
class Gun : public Weapon {
public:
    void attack() override { cout << "ğŸ”« ç”¨æªå°„å‡»" << endl; }
};

class BulletproofVest : public Armor {
public:
    void defend() override { cout << "ğŸ§¥ ç”¨é˜²å¼¹è¡£é˜²å¾¡" << endl; }
};

class ModernFactory : public EquipmentFactory {
public:
    Weapon* createWeapon() override { return new Gun(); }
    Armor* createArmor() override { return new BulletproofVest(); }
};

// æ¸¸æˆè§’è‰²
class GameCharacter {
private:
    EquipmentFactory* factory;
    
public:
    GameCharacter(EquipmentFactory* factory) : factory(factory) {}
    
    void equip() {
        Weapon* weapon = factory->createWeapon();
        Armor* armor = factory->createArmor();
        
        cout << "è§’è‰²è£…å¤‡äº†ï¼š" << endl;
        weapon->attack();
        armor->defend();
        
        delete weapon;
        delete armor;
    }
};

// ä½¿ç”¨
int main() {
    // åˆ›å»ºä¸­ä¸–çºªé£æ ¼è§’è‰²
    EquipmentFactory* medievalFactory = new MedievalFactory();
    GameCharacter knight(medievalFactory);
    cout << "ä¸­ä¸–çºªéª‘å£«ï¼š" << endl;
    knight.equip();
    
    cout << "\n-------------------\n" << endl;
    
    // åˆ›å»ºç°ä»£é£æ ¼è§’è‰²
    EquipmentFactory* modernFactory = new ModernFactory();
    GameCharacter soldier(modernFactory);
    cout << "ç°ä»£å£«å…µï¼š" << endl;
    soldier.equip();
    
    delete medievalFactory;
    delete modernFactory;
    return 0;
}
```

## æŠ½è±¡å·¥å‚æ¨¡å¼ vs å·¥å‚æ–¹æ³•æ¨¡å¼


åœºæ™¯ï¼šè¦å¼€ä¸€å®¶æŠ«è¨åº—è¿é”ä¼ä¸š

å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šç‰¹è®¸ç»è¥æ¨¡å¼

**æ¦‚å¿µ**ï¼šæ€»éƒ¨è§„å®šåšæŠ«è¨çš„æµç¨‹ï¼Œä½†æ¯å®¶åˆ†åº—è‡ªå·±å†³å®šåšä»€ä¹ˆé£å‘³çš„æŠ«è¨ã€‚

**ç‰¹ç‚¹**ï¼š
- æ¯å®¶åˆ†åº—åªåš**ä¸€ç§äº§å“**ï¼ˆæŠ«è¨ï¼‰
- ä½†å¯ä»¥åšä¸åŒé£å‘³çš„æŠ«è¨
- æ€»éƒ¨æ§åˆ¶æµç¨‹ï¼Œåˆ†åº—æ§åˆ¶é£å‘³

---

æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå“ç‰Œæ——èˆ°åº—æ¨¡å¼

**æ¦‚å¿µ**ï¼šæ€»éƒ¨å¼€è®¾ä¸åŒå“ç‰Œçš„æ——èˆ°åº—ï¼Œæ¯ä¸ªå“ç‰Œåº—æä¾›ä¸€æ•´å¥—é…å¥—äº§å“ã€‚

**ç‰¹ç‚¹**ï¼š
- æ¯ä¸ªå“ç‰Œåº—æä¾›**ä¸€æ•´å¥—äº§å“**ï¼ˆæŠ«è¨+é¥®æ–™+ç”œç‚¹ï¼‰
- äº§å“ä¹‹é—´é£æ ¼åè°ƒé…å¥—
- åˆ‡æ¢å“ç‰Œå°±åˆ‡æ¢äº†æ•´ä¸ªäº§å“ç³»åˆ—

---

å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š**å‚ç›´ specialization**
```
æ€»éƒ¨ â†’ å„ä¸ªåˆ†åº—
    â”œâ”€ çº½çº¦åº—ï¼šä¸“åšçº½çº¦é£å‘³æŠ«è¨
    â”œâ”€ èŠåŠ å“¥åº—ï¼šä¸“åšèŠåŠ å“¥é£å‘³æŠ«è¨
    â””â”€ åŠ å·åº—ï¼šä¸“åšåŠ å·é£å‘³æŠ«è¨
```
**å…³æ³¨ç‚¹**ï¼šä¸€ç§äº§å“çš„ä¸åŒé£å‘³å˜ä½“

æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š**æ°´å¹³ integration**
```
æ€»éƒ¨ â†’ å„ä¸ªå“ç‰Œåº—
    â”œâ”€ æ„å¤§åˆ©åº—ï¼šæ„å¼æŠ«è¨ + è‘¡è„é…’ + ææ‹‰ç±³è‹
    â”œâ”€ ç¾å¼åº—ï¼šç¾å¼æŠ«è¨ + å¯ä¹ + èŠå£«è›‹ç³•
    â””â”€ å¢¨å¼åº—ï¼šå¢¨è¥¿å“¥æŠ«è¨ + é¾™èˆŒå…° + å·§å…‹åŠ›
```
**å…³æ³¨ç‚¹**ï¼šå¤šæ¬¾äº§å“çš„é…å¥—ç»„åˆ

---

| æ–¹é¢         | å·¥å‚æ–¹æ³•æ¨¡å¼           | æŠ½è±¡å·¥å‚æ¨¡å¼     |
| ------------ | ---------------------- | ---------------- |
| **åˆ›å»ºä»€ä¹ˆ** | ä¸€ç§äº§å“               | ä¸€å¥—ç›¸å…³äº§å“     |
| **å…³æ³¨ç‚¹**   | äº§å“ç±»å‹çš„æ‰©å±•         | äº§å“å®¶æ—çš„å…¼å®¹   |
| **å®ç°æ–¹å¼** | ç»§æ‰¿ï¼ˆå­ç±»åŒ–ï¼‰         | ç»„åˆï¼ˆæ¥å£å®ç°ï¼‰ |
| **ä¿®æ”¹å½±å“** | æ·»åŠ æ–°äº§å“ç±»å‹         | æ·»åŠ æ–°äº§å“å®¶æ—   |
| **é€‚ç”¨åœºæ™¯** | éœ€è¦å¤šç§é£å‘³çš„å•ä¸€äº§å“ | éœ€è¦å¤šæ¬¾é…å¥—äº§å“ |

---

å·¥å‚æ–¹æ³•æ¨¡å¼åƒï¼š**æ±½è½¦4Såº—**
- å®é©¬4Såº—ï¼šå–å„ç§å®é©¬è½¦å‹ï¼ˆ3ç³»ã€5ç³»ã€7ç³»ï¼‰
- å¥”é©°4Såº—ï¼šå–å„ç§å¥”é©°è½¦å‹ï¼ˆCçº§ã€Eçº§ã€Sçº§ï¼‰
- **åªå–ä¸€ä¸ªå“ç‰Œï¼Œä½†å¤šç§è½¦å‹**

æŠ½è±¡å·¥å‚æ¨¡å¼åƒï¼š**å®¶å±…å•†åŸ**
- å®œå®¶ä¸“åŒºï¼šå®œå®¶æ²™å‘ + å®œå®¶èŒ¶å‡  + å®œå®¶è¡£æŸœ
- çº¢æ˜Ÿç¾å‡¯é¾™ä¸“åŒºï¼šçº¢æœ¨æ²™å‘ + çº¢æœ¨èŒ¶å‡  + çº¢æœ¨è¡£æŸœ
- **æä¾›ä¸€æ•´å¥—é£æ ¼åŒ¹é…çš„äº§å“**

---


**æ ¸å¿ƒæ€æƒ³**ï¼šä¿è¯åŒä¸€å®¶æ—çš„äº§å“èƒ½å¤Ÿåè°ƒå·¥ä½œï¼Œè½»æ¾åˆ‡æ¢æ•´ä¸ªäº§å“ç³»åˆ—ã€‚

**ä½¿ç”¨æ—¶æœº**ï¼š
- ç³»ç»Ÿéœ€è¦ä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡
- éœ€è¦ä¿è¯äº§å“ä¹‹é—´çš„å…¼å®¹æ€§
- å¸Œæœ›éšè—å…·ä½“äº§å“çš„åˆ›å»ºç»†èŠ‚
- éœ€è¦è½»æ¾åˆ‡æ¢ä¸åŒçš„äº§å“ç³»åˆ—

æŠ½è±¡å·¥å‚æ¨¡å¼è®©ä»£ç æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿè½»æ¾åº”å¯¹äº§å“å®¶æ—çš„åˆ‡æ¢éœ€æ±‚ï¼


æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚

```cpp
#include <iostream>
#include <memory>

// æŠ½è±¡äº§å“Aï¼šæŒ‰é’®
class Button {
public:
    virtual void paint() = 0;
    virtual ~Button() = default;
};

// æŠ½è±¡äº§å“Bï¼šæ»šåŠ¨æ¡
class ScrollBar {
public:
    virtual void paint() = 0;
    virtual ~ScrollBar() = default;
};

// å…·ä½“äº§å“ï¼šWindowsé£æ ¼æŒ‰é’®
class WinButton : public Button {
public:
    void paint() override {
        std::cout << "Painting Windows style button" << std::endl;
    }
};

// å…·ä½“äº§å“ï¼šWindowsé£æ ¼æ»šåŠ¨æ¡
class WinScrollBar : public ScrollBar {
public:
    void paint() override {
        std::cout << "Painting Windows style scrollbar" << std::endl;
    }
};

// å…·ä½“äº§å“ï¼šMacé£æ ¼æŒ‰é’®
class MacButton : public Button {
public:
    void paint() override {
        std::cout << "Painting Mac style button" << std::endl;
    }
};

// å…·ä½“äº§å“ï¼šMacé£æ ¼æ»šåŠ¨æ¡
class MacScrollBar : public ScrollBar {
public:
    void paint() override {
        std::cout << "Painting Mac style scrollbar" << std::endl;
    }
};

// æŠ½è±¡å·¥å‚
class GUIFactory {
public:
    virtual std::unique_ptr<Button> createButton() = 0;
    virtual std::unique_ptr<ScrollBar> createScrollBar() = 0;
    virtual ~GUIFactory() = default;
};

// å…·ä½“å·¥å‚ï¼šWindowså·¥å‚
class WinFactory : public GUIFactory {
public:
    std::unique_ptr<Button> createButton() override {
        return std::make_unique<WinButton>();
    }
    
    std::unique_ptr<ScrollBar> createScrollBar() override {
        return std::make_unique<WinScrollBar>();
    }
};

// å…·ä½“å·¥å‚ï¼šMacå·¥å‚
class MacFactory : public GUIFactory {
public:
    std::unique_ptr<Button> createButton() override {
        return std::make_unique<MacButton>();
    }
    
    std::unique_ptr<ScrollBar> createScrollBar() override {
        return std::make_unique<MacScrollBar>();
    }
};

// å®¢æˆ·ç«¯ä»£ç 
class Application {
public:
    Application(std::unique_ptr<GUIFactory> factory) : factory(std::move(factory)) {}
    
    void createUI() {
        button = factory->createButton();
        scrollBar = factory->createScrollBar();
    }
    
    void paint() {
        button->paint();
        scrollBar->paint();
    }

private:
    std::unique_ptr<GUIFactory> factory;
    std::unique_ptr<Button> button;
    std::unique_ptr<ScrollBar> scrollBar;
};

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    // åˆ›å»ºWindowsé£æ ¼çš„UI
    auto winFactory = std::make_unique<WinFactory>();
    Application winApp(std::move(winFactory));
    winApp.createUI();
    winApp.paint();
    
    std::cout << "-------------------" << std::endl;
    
    // åˆ›å»ºMacé£æ ¼çš„UI
    auto macFactory = std::make_unique<MacFactory>();
    Application macApp(std::move(macFactory));
    macApp.createUI();
    macApp.paint();
    
    return 0;
}
```